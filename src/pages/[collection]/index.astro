---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const paths: any[] = [];

  // Manually define the collection mappings for now
  const collectionMappings = [
    { name: "blog", collection: "blog", displayName: "Blog" },
    { name: "weeknotes", collection: "weeknotes", displayName: "Week Notes" },
    { name: "poetry", collection: "poetry", displayName: "Poetry" },
    {
      name: "digital-garden",
      collection: "digitalGarden",
      displayName: "Digital Garden",
    },
  ];

  for (const mapping of collectionMappings) {
    try {
      const posts = await getCollection(mapping.collection);

      paths.push({
        params: { collection: mapping.name },
        props: {
          posts: posts.sort(
            (a, b) =>
              new Date(b.data.publishedOn).getTime() -
              new Date(a.data.publishedOn).getTime(),
          ),
          collectionName: mapping.name,
          displayName: mapping.displayName,
        },
      });
    } catch (error) {
      console.warn(`Failed to load collection ${mapping.collection}:`, error);
    }
  }

  return paths;
}

const { posts, collectionName, displayName } = Astro.props;
---

<Layout>
  <main class="max-w-3xl mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8">{displayName}</h1>

    <div class="space-y-6">
      {
        posts.map((post: any) => (
          <article class="border-b border-gray-200 pb-6">
            <h2 class="text-2xl font-semibold mb-2">
              <a
                href={`/${collectionName}/${post.id}`}
                class="hover:text-blue-600"
              >
                {post.data.title}
              </a>
            </h2>
            <time class="text-gray-600 text-sm">
              {new Date(post.data.publishedOn).toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })}
            </time>
          </article>
        ))
      }
    </div>
  </main>
</Layout>
